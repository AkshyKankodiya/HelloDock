name: mail on faili test

on:
  schedule:
    - cron: "0 6,12,18,0 * * *"  
  workflow_dispatch:
    inputs:
      choice:
        type: choice
        description: Select The Environment URL
        options:
          - https://qa.hellodock.com/
          - https://dev.hellodock.com/
          - https://app.hellodock.com/

jobs:
  test:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Install Playwright browsers
        run: npx playwright install

      - name: Install Playwright Allure
        run: npm install --save-dev allure-playwright

      # Run Playwright tests and allow them to fail without stopping the workflow
      - name: Run Playwright tests
        env:
          BASE_URL: ${{ github.event.inputs.choice }}
        run: |
          npx playwright test --reporter=line,allure-playwright
        continue-on-error: true
        id: playwright-tests

      # Set CC email if there were test failures
      - name: Set CC Email for test failures
        if: steps.playwright-tests.outcome == 'failure'
        run: echo "CC_EMAIL=tqa8769@gmail.com" >> $GITHUB_ENV

      # Set CC email to empty if all tests passed
      - name: Set CC Email for success (No CC)
        if: steps.playwright-tests.outcome == 'success'
        run: echo "CC_EMAIL=" >> $GITHUB_ENV

      # Upload Playwright test results as artifacts
      - name: Upload Playwright test results
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: '**/test-results/**'

      # Upload Allure results
      - name: Upload Allure Results
        uses: actions/upload-artifact@v3
        with:
          name: allure-results
          path: ./allure-results

      # Get Build URL for email
      - name: Get Build URL
        run: |
          echo "The Build URL is: https://
